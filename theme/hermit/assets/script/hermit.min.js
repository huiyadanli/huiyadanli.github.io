(function(r,h,u){var j=soundManager,i=null,m=null,a=100,k=[],e={},q,g=-1;if("Microsoft Internet Explorer"==navigator.appName){var s=navigator.userAgent,t=/MSIE ([0-9]{1,}[.0-9]{0,})/;null!=t.exec(s)&&(g=parseFloat(RegExp.$1))}else{"Netscape"==navigator.appName&&(s=navigator.userAgent,t=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/,null!=t.exec(s)&&(g=parseFloat(RegExp.$1)))}q=g;var o="createTouch" in h||"ontouchstart" in r,p=o?"touchstart":"click",x=o?"touchstart":"mousedown",v=o?"touchmove":"mousemove",w=o?"touchend":"mouseup";j.url=hermit.url;j.debugMode=hermit.debugMode||false;j.debugFlash=hermit.debugFlash||false;j.preferFlash=hermit.preferFlash||(5<q?!0:!1);j.flashVersion=hermit.flashVersion||8;e.init=function(){this.fn.getjson()};e.fn={handleHash:{},bind:h.addEventListener?function(c,b,d){b.addEventListener(c,function(){d.apply(this,arguments);e.fn.handleHash[c]=e.fn.handleHash[c]||[];e.fn.handleHash[c].push(arguments.callee)},!1)}:h.attachEvent?function(c,b,d){b.attachEvent("on"+c,function(){d.apply(this,arguments);e.fn.handleHash[c]=e.fn.handleHash[c]||[];e.fn.handleHash[c].push(arguments.callee)})}:void 0,unbind:h.removeEventListener?function(c,b){if(e.fn.handleHash[c]){var d=0,f=e.fn.handleHash[c].length;for(d;f>d;d+=1){b.removeEventListener(c,e.fn.handleHash[c][d],!1)}}}:h.detachEvent?function(c,b){if(e.fn.handleHash[c]){var d=0,f=e.fn.handleHash[c].length;for(d;f>d;d+=1){b.detachEvent("on"+c,e.fn.handleHash[c][d])}}}:void 0,rclass:/[\n\t]/g,rspaces:/\s+/,arraify:function(f){var l=[];try{l=Array.prototype.slice.call(f,0)}catch(c){for(var d,l=[],b=0;d=f[b++];){l.push(d)}}return l},hasClass:function(c,b){return 0<=(" "+c.className+" ").replace(e.fn.rclass," ").indexOf(" "+b+" ")?!0:!1},addClass:function(y,c){if(c&&"string"==typeof c){var d=(c||"").split(e.fn.rspaces);if(1===y.nodeType){if(y.className){for(var l=" "+y.className+" ",b=y.className,f=0,n=d.length;n>f;f++){0>l.indexOf(" "+d[f]+" ")&&(b+=" "+d[f])}y.className=e.fn.trim(b)}else{y.className=c}}}},removeClass:function(b,c){if(c&&"string"==typeof c||void 0===c){var d=(c||"").split(e.fn.rspaces);if(1===b.nodeType&&b.className){if(c){for(var l=(" "+b.className+" ").replace(e.fn.rclass," "),f=0,n=d.length;n>f;f++){l=l.replace(" "+d[f]+" "," ")}b.className=e.fn.trim(l)}else{b.className=""}}}},getById:function(b){return h.getElementById(b)},getByTagName:function(c,b){return b=b||h,e.fn.arraify(b.getElementsByTagName(c))},getByClassName:function(c,b,d){if(b=b||h,b.getElementsByClassName){return e.fn.arraify(b.getElementsByClassName(c))}for(var c=c.replace(/\-/g,"\\-"),f=[],b=e.fn.getByTagName(d||"*",b),d=b.length,c=RegExp("(^|\\s)"+c+"(\\s|$)");d--;){c.test(b[d].className)&&f.push(b[d])}return f.reverse(),f},each:function(d,f){if(u!=d.length){for(var b=0,c=d.length;c>b&&!1!==f.call(d[b],b,d[b]);b++){}}else{for(name in d){f.call(d[name],name,d[name])}}},index:function(d,f){var b,c=f.length;for(b=0;c>b;b++){if(d==f[b]){return b}}return -1},trim:function(b){return b.replace(/^(\s|\u00A0)+/,"").replace(/(\s|\u00A0)+$/,"")},getjson:function(){var c=e.fn.getByClassName("hermit"),b=c.length-1;e.fn.each(c,function(l){var y=this;var z=y.getAttribute("xiami");var A=y.getAttribute("netease");var f={collect_id:12345,songs:[]};jQuery(".hermit-add-song").each(function(C,D){f.songs.push({name:jQuery(D).data("title"),url:jQuery(D).data("url"),artists:jQuery(D).data("author"),})});var d=z?z:A;var B=z?"xiami":"netease";var n=d.split(":");e.fn.ajaxp({url:"http://app.atime.me/music-api-server/",param:{p:B,t:n[0],i:n[1]},after:function(D){for(var C in D.songs){f.songs.push(D.songs[C])}e.fn.createPlayListUI.call(y,f,l);l==b&&e.fn.autoPlay()}});if(!z&&!A){e.fn.createPlayListUI.call(y,f,l);l==b&&e.fn.autoPlay()}})},create:function(c){var b=this;m=null!=c?c:0;i=null!=i?i:0;e.sound&&(e.sound.destruct(),i==k[m].length&&(i=0));j.onready(function(){e.sound=j.createSound({id:"goXiami",url:k[m][i].src,volume:a,autoLoad:!1,ondataerror:function(){console.log("fuck")},onconnect:function(){console.log("connect")},onload:function(){3>this.readyState&&(e.fn.getByClassName("hermit-detail",b,"div")[0].innerHTML="\u97f3\u4e50\u64ad\u653e\u5668\u521d\u59cb\u5316\u5931\u8d25!")},whileloading:function(){e.fn.getByClassName("hermit-loaded",b,"div")[0].style.width=100*(this.bytesLoaded/this.bytesTotal)+"%"},whileplaying:function(){var d=e.fn.getByClassName("hermit-duration",b,"div")[0],l=e.fn.getByClassName("hermit-prosess-bar",b,"div")[0],f=100*(this.position/this.duration)+"%",n=e.fn.parseTime(this.position/1000)+"/"+e.fn.parseTime(this.duration/1000);!e.moving&&(l.style.width=f);d.innerHTML=n},onplay:function(){var d=e.fn.getByClassName("hermit-song",b,"div"),f=e.fn.getByClassName("hermit-detail",b,"div")[0];e.fn.each(d,function(){e.fn.removeClass(this,"selected")});e.fn.addClass(d[i],"selected");f.innerHTML=e.fn._expect(d[i].innerHTML,0,40,"...")+"  ("+(i+1)+"/"+k[m].length+")"},onpause:function(){},onfinish:function(){if(i++,e.sound.resume(),i<k[m].length){e.fn.create.call(b,m)}else{if(parseInt(b.getAttribute("loop"),10)){e.fn.getByClassName("hermit-song",b,"div")[0].click()}else{var d=e.fn.getByClassName("hermit-prosess-bar",b,"div")[0],n=e.fn.getByClassName("hermit-button",b,"div")[0],l=e.fn.getByClassName("hermit-duration",b,"div")[0],f=e.fn.getByClassName("hermit-song",b,"div");e.fn.each(f,function(){e.fn.removeClass(this,"selected")});d.style.width=0;m=i=null;e.sound=null;l.innerHTML="";e.fn.removeClass(n,"playing")}}}});e.sound.play()})},createPlayListUI:function(c,b){var d=e.fn.getByClassName("hermit-list",this,"div")[0],l="";if(k[b]=[],c.album_id||c.collect_id){c=c.songs,e.fn.each(c,function(){null!=this&&(k[b].push({src:this.url}),l+='<div class="hermit-song">'+this.name+" - "+this.artists+"</div>")})}else{var f=this.getAttribute("xiami").split(":")[1],f=f.split(",");e.fn.each(f,function(){null!=c[this]&&(k[b].push({src:c[this].url}),l+='<div class="hermit-song">'+c[this].name+" - "+c[this].artists+"</div>")})}d.innerHTML=l;e.fn.playEvent.call(this)},playEvent:function(){var b=this,A=e.fn.getByClassName("hermit-button",b,"div")[0],c=e.fn.getByClassName("hermit-volume",b,"div")[0],f=e.fn.getByClassName("hermit-listbutton",b,"div")[0],d=e.fn.getByClassName("hermit-list",b,"div")[0],n=e.fn.getByClassName("hermit-song",d,"div"),z=(parseInt(e.fn._getStyle(n[0],"height"))+1)*n.length,l=e.fn.getByClassName("hermit-prosess",b,"div")[0],y=e.fn.getByClassName("hermit-prosess-after",l,"div")[0],z=360>=z?z:360,z=z+"px";d.style.height=z;e.fn.each(n,function(){var B=e.fn.index(b,e.fn.getByClassName("hermit"));e.fn.bind(p,this,function(){var E=e.fn.index(this,n);if(m==B){E==i?A.click():function(){var F=e.fn.getByClassName("hermit")[m],G=e.fn.getByClassName("hermit-button",F,"div")[0];if(!e.fn.hasClass(G,"playing")){e.fn.addClass(G,"playing")}i=E;e.fn.create.call(b,B)}()}else{if(e.sound){var C=e.fn.getByClassName("hermit")[m],D=e.fn.getByClassName("hermit-button",C,"div")[0],C=e.fn.getByClassName("hermit-song",C,"div")[i];e.fn.removeClass(D,"playing");e.fn.removeClass(C,"selected");e.sound.resume()}i=E;e.fn.addClass(A,"playing");e.fn.create.call(b,B)}})});e.fn.bind(p,A,function(){var B=e.fn.index(b,e.fn.getByClassName("hermit"));if(e.fn.hasClass(A,"playing")){e.fn.removeClass(A,"playing"),e.sound.pause()}else{if(e.fn.addClass(A,"playing"),e.sound&&m==B){e.sound.play()}else{if(e.sound){var C=e.fn.getByClassName("hermit")[m],D=e.fn.getByClassName("hermit-button",C,"div")[0],C=e.fn.getByClassName("hermit-song",C,"div")[i];i=null;e.fn.removeClass(D,"playing");e.fn.removeClass(C,"selected")}e.fn.create.call(b,B)}}});e.fn.bind(p,f,function(){e.fn.hasClass(b,"unexpand")?(e.fn.removeClass(b,"unexpand"),d.style.height=z):(e.fn.addClass(b,"unexpand"),d.style.height=0)});e.fn.bind(p,c,function(){var B=e.fn.getByClassName("hermit-volume",null,"div");e.fn.hasClass(c,"muted")?(e.fn.each(B,function(){e.fn.removeClass(this,"muted")}),a=100,e.sound&&e.sound.setVolume(100)):(e.fn.each(B,function(){e.fn.addClass(this,"muted")}),a=0,e.sound&&e.sound.setVolume(0))});e.fn.bind(p,l,function(B){if(e.sound){var D=parseInt(e.fn._getStyle(l,"width")),C=e.fn._offset(l).left,B=e.fn._pageEvent(B).pageX-C,B=B/D*e.sound.duration;e.sound.setPosition(B)}});e.fn.bind(x,y,e.fn._bind(e.fn._start,b))},autoPlay:function(){var b=e.fn.getByClassName("hermit");e.fn.each(b,function(){if(parseInt(this.getAttribute("auto"),10)){return e.fn.getByClassName("hermit-button",this,"div")[0].click(),!1}})},_pageEvent:function(c){if(c=c||r.event,o&&c.touches.length){c.pageX=c.touches.item(0).pageX,c.pageY=c.touches.item(0).pageY}else{if("undefined"==typeof c.pageX){var d=h.documentElement,b=h.body;c.pageX=c.clientX+(d&&d.scrollLeft||b&&b.scrollLeft||0)-(d&&d.clientLeft||b&&b.clientLeft||0);c.pageY=c.clientY+(d&&d.scrollTop||b&&b.scrollTop||0)-(d&&d.clientTop||b&&b.clientTop||0)}}return c},_expect:function(d,f,b,c){return c=d.length>b-f?c:"",d=d.slice(f,b),d+c},_offset:function(c){var d=c.getBoundingClientRect(),b=c.ownerDocument,c=b.body,b=b.documentElement;return{top:d.top+(self.pageYOffset||b.scrollTop||c.scrollTop)-(b.clientTop||c.clientTop||0),left:d.left+(self.pageXOffset||b.scrollLeft||c.scrollLeft)-(b.clientLeft||c.clientLeft||0)}},_getStyle:function(b,c){return 5<q&&9>q?(c=c.replace(/^(\w)/g,function(f,d){return d.toUpperCase()}),b["client"+c]):h.defaultView.getComputedStyle(b,null).getPropertyValue(c)},_bind:function(b,c){return function(){return b.apply(c,arguments)}},_start:function(){e.moving=!0;e.fn.bind(v,h,e.fn._bind(e.fn._move,this));e.fn.bind(w,h,e.fn._bind(e.fn._end,this));e.fn.bind("touchcancel",h,e.fn._bind(e.fn._end,this))},_move:function(c){event=e.fn._pageEvent(c);var b=e.fn.getByClassName("hermit-prosess",this,"div")[0],c=e.fn.getByClassName("hermit-prosess-bar",b,"div")[0],d=parseInt(e.fn._getStyle(b,"width")),b=e.fn._offset(b).left,b=event.pageX-b,d=b/d;c.style.width=100*(1<d?1:d)+"%"},_end:function(){e.fn.getByClassName("hermit-prosess-after",this,"div")[0];if(e.sound){var c=e.fn.getByClassName("hermit-prosess",this,"div")[0],b=e.fn.getByClassName("hermit-prosess-bar",c,"div")[0],c=parseInt(e.fn._getStyle(c,"width")),b=parseInt(e.fn._getStyle(b,"width")),b=b/c,b=(1<b?1:b)*e.sound.duration;e.sound.setPosition(b)}e.fn.unbind(v,h);e.fn.unbind(w,h);e.fn.unbind("touchcancel",h);try{delete e.moving}catch(d){e.moving=u}e.fn.handleHash={}},ajaxp:function(b){setTimeout(function(){var d=(new Date).valueOf(),c=h.createElement("script");body=h.documentElement;head=body.getElementsByTagName("head")[0];callbackName="hermit"+parseInt(999999*Math.random());b.param.c=callbackName;b.param._=d;r[callbackName]=function(f){b.after.call(this,f);head.removeChild(c)};c.src=b.url+"?"+e.fn.serialize(b.param);head.appendChild(c)},0)},_loadScript:function(c,b){setTimeout(function(){var d=h.createElement("script");d.src=c;d.readyState?e.fn.bind("readystatechange",d,function(){("loaded"===d.readyState||"complete"===d.readyState)&&(b&&b(),e.fn.unbind("readystatechange",d))}):e.fn.bind("load",d,function(){b&&b();e.fn.unbind("load",d)});h.getElementsByTagName("head")[0].appendChild(d)},0)},serialize:function(b){var c=[];for(key in b){key=[key,b[key]].join("="),c.push(key)}return c.join("&")},parseTime:function(b){if(!isFinite(b)||0>b){return"--:--"}var c=Math.floor(b/60),b=Math.floor(b)%60;return(10>c?"0"+c:c)+":"+(10>b?"0"+b:b)}};e.init()})(window,document);