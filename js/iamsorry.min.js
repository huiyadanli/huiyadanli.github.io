function average(e){for(var t=0,n=e.length,i=0;i<n;++i)t+=e[i];return t/n}function bubbleSort(e){for(var t=!1,n=[];!t;){t=!0;for(var i=0;i<e.length-1;++i)n.push(e.slice()),e[i]>e[i+1]&&(e.swap(i,i+1),t=!1);n.push(e.slice())}return n}function setHash(e,t){window.location.replace("#"+e)}function setCurrentFun(e){currentFun=e}navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,Array.prototype.swap=function(e,t){var n=this[e];return this[e]=this[t],this[t]=n,this},String.prototype.startsWith=function(e){return 0==this.indexOf(e)};var currentFun="click",hash=window.location.hash;if(hash.startsWith("#diy")){hash=decodeURI(hash),console.log(hash);try{var currentFun="diy",frameRate=hash.split(".")[1];$('input[type="range"]').val(frameRate);var frames=hash.split(".").slice(2,1e8).map(function(e){return""==e?".":e.startsWith("\\n")?"."+e:e}).join("").split("\\n");$("textarea").val(frames.join("\n")),$("#diy").slideDown()}catch(e){}}$(document).on("mousemove",function(e){window.mouseX=e.pageX}),window.up=!1,window.down=!1,window.space=!1,Mousetrap.bind("up",function(){window.up=!0},"keydown"),Mousetrap.bind("up",function(){window.up=!1},"keyup"),Mousetrap.bind("down",function(){window.down=!0},"keydown"),Mousetrap.bind("down",function(){window.down=!1},"keyup"),Mousetrap.bind("space",function(){window.space=!0},"keydown"),Mousetrap.bind("space",function(){window.space=!1},"keyup");var now=0,tick=function(){now+=50,FUNctions[currentFun](now,state[currentFun]),setTimeout(tick,50)};state={click:{past:0,index:0},shark:{position:0,waterLength:30,right:!0,past:0},swim:{position:0,waterLength:30,right:!0,past:0},plane:{position:0,skyLength:150,right:!0,propeller:"|"},flip:{currentFrameIndex:0,right:!0},bubblesort:{past:0,steps:bubbleSort([4,5,3,0,1,2]),index:0},O:{index:0,past:0},squiggle:{currentFrameIndex:0,past:0,prevHash:""},wave:{index:0,right:!0,prevMouseX:0},wave2:{index:0,right:!0,prevMouseX:0},bounce:{position:0,right:!0},listen:{hasSetup:!1,isSettingUp:!1,context:"undefined"==typeof webkitAudioContext?new AudioContext:new webkitAudioContext,volume:0},diy:{index:0,past:0},pewpew:{shipIndex:2,score:0,dead:!1,bullets:[],enemies:[" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "]}},FUNctions={click:function(e,t){if(e-t.past>1e3){var n=["CLICK","  A","LINK"];setHash(n[t.index],"i'm sorry"),t.index=t.index==n.length-1?0:t.index+1,t.past=e}},loading:function(){var e={" |":" /"," /":" –"," –":" \\"," \\":" |"},t=window.location.hash.replace("#","");t in e?setHash(e[t],"loading"):setHash(" |","loading")},shark:function(e,t){for(var n="",i=t.right?"|\\":"/|",r=0;r<t.waterLength;++r)n+=r==t.position?i:r==t.waterLength-1?"#":"_";t.position+=t.right?1:-1,t.position>t.waterLength-3?t.right=!1:t.position<=0&&(t.right=!0),setHash(n,"shaaark")},swim:function(e,t){for(var n="",i=t.right?"|\\":"/|",r=["/","-","\\"][t.position%3],o=t.right?">-"+r+"o":"o"+r+"-<",s=t.right?i+"~~~~"+o:o+"~~~~"+i,a=0;a<t.waterLength;++a)n+=a==t.position?s:"~";t.position+=t.right?1:-1,t.position>t.waterLength-2?t.right=!1:t.position<=0&&(t.right=!0),setHash(n,"swim")},plane:function(e,t){for(var n="",i={"|":"/","/":"-","-":"\\","\\":"|"},r=t.propeller,o=t.right?"`--//->":"<-\\\\--'",s=t.right?o+r:r+o,a=0;a<t.skyLength;++a)a==t.position?(n+=s,a+=s.length):n+=" ";t.position+=t.right?1:-1,t.position>=t.skyLength-1?t.right=!1:t.position<=0&&(t.right=!0),t.propeller=i[t.propeller],setHash(n,"plane")},O:function(e,t){if(e-t.past>90){var n=[":O                #","  Ö               #","   O:             #","     O̤            #","      :O          #","        Ö         #","          O:      #","            O̤     #","             :O   #","               Ö  #","                O:#","               Ö  #","             :O   #","            O̤     #","          O:      #","        Ö         #","      :O          #","     O̤            #","   O:             #","  Ö               #"];t.index>n.length-1&&(t.index=0),setHash(n[t.index],":O"),t.index+=1,t.past=e}},flip:function(e,t){var n=["(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°-°)\\ ┬─┬","(\\°□°)\\  ┬─┬","(\\°□°)\\  ┬─┬","(-°□°)-  ┬─┬","(-°□°)-  ┬─┬","(╯°□°)╯    ]","(╯°□°)╯    ]","(╯°□°)╯    ]","(╯°□°)╯    ]","(╯°□°)╯  ︵  ┻━┻","(╯°□°)╯  ︵  ┻━┻","(╯°□°)╯  ︵  ┻━┻","(╯°□°)╯  ︵  ┻━┻","(╯°□°)╯       [","(╯°□°)╯       [","(╯°□°)╯       [","(╯°□°)╯       [","(╯°□°)╯       ︵  ┬─┬","(╯°□°)╯       ︵  ┬─┬","(╯°□°)╯       ︵  ┬─┬","(╯°□°)╯       ︵  ┬─┬","(╯°□°)╯                 ]","(╯°□°)╯                 ]","(╯°□°)╯                 ]","(╯°□°)╯                 ]","(╯°□°)╯               ︵  ┻━┻","(╯°□°)╯               ︵  ┻━┻","(╯°□°)╯               ︵  ┻━┻","(╯°□°)╯               ︵  ┻━┻","(╯°□°)╯                         [","(╯°□°)╯                         [","(╯°□°)╯                         [","(╯°□°)╯                         [","(\\°-°)\\                            ︵  ┬─┬","(\\°-°)\\                            ︵  ┬─┬","(\\°-°)\\                            ︵  ┬─┬","(\\°-°)\\                            ︵  ┬─┬","(\\°-°)\\                                     ]","(\\°-°)\\                                     ]","(\\°-°)\\                                     ]","(\\°-°)\\                                     ]","(\\°-°)\\                                     ︵ ┻━┻","(\\°-°)\\                                     ︵ ┻━┻","(\\°-°)\\                                     ︵ ┻━┻","(\\°-°)\\                                     ︵ ┻━┻","(\\°-°)\\                                               [","(\\°-°)\\                                               [","(\\°-°)\\                                               [","(\\°-°)\\                                               [","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬","(\\°-°)\\                                              ┬─┬"];setHash(" "+n[t.currentFrameIndex],"flip"),t.currentFrameIndex>=n.length-1?t.right=!1:t.currentFrameIndex<=0&&(t.right=!0),t.currentFrameIndex+=t.right?1:-1},bubblesort:function(e,t){if(e-t.past>1e3){for(var n=["▁","▃","▄","▅","▆","▇"],i=t.steps[t.index],r="",o=0;o<i.length;++o){var s=i[o];r+=t.index%n.length==o?"["+n[s]+"]":n[s]}t.index=t.index>=t.steps.length-1?0:t.index+1,t.past=e,setHash(r,"bubblesort")}},squiggle:function(e,t){if(e-t.past>100){var n=[" ̲","ﺭ","ﬤ","ᕊ","5","5 ͞","5 ͞ ̅ᐣ","5 ͞ᕈ","5 ͞Ƨ","5 ͞Ƨ_"],i=n[t.currentFrameIndex],r=t.prevHash+i;t.currentFrameIndex>=n.length-1?(t.prevHash+=i,t.currentFrameIndex=0):t.currentFrameIndex+=1,t.past=e,setHash(r,"squiggle")}},wave:function(e,t){for(var n=["¸",".","·","´","¯","`","·",".","¸"],i="",r=0;r<800;++r)i+=n[(r+t.index)%n.length];var o=window.mouseX;o>t.prevMouseX?t.right=!0:o<t.prevMouseX?t.right=!1:t.right=t.right,t.right?(setHash(i.split("").reverse().join(""),"wave"),t.right=!0):(setHash(i,"wave"),t.right=!1),t.index=t.index==n.length-1?0:t.index+1,t.prevMouseX=o},wave2:function(e,t){for(var n=["䷫","䷌","䷉","䷈","䷍","䷈","䷉","䷌"],i="",r=0;r<800;++r)i+=n[(r+t.index)%n.length];var o=window.mouseX;o>t.prevMouseX?t.right=!0:o<t.prevMouseX?t.right=!1:t.right=t.right,t.right?(setHash(i.split("").reverse().join(""),"wave2"),t.right=!0):(setHash(i,"wave2"),t.right=!1),t.index=t.index==n.length-1?0:t.index+1,t.prevMouseX=o},bounce:function(e,t){for(var n=["¸",".","·","´","`","·","."],i=29,r="",o=0;o<i;++o)r+=o==i-1?"#":o==t.position?n[o%n.length]:" ";t.position>=i-1?t.right=!1:t.position<=0&&(t.right=!0),t.position+=t.right?1:-1,setHash(r,"bounce")},listen:function(e,t){if(t.hasSetup||t.isSettingUp){if(t.hasSetup){for(var n=Math.round(2*t.volume),i="",r=0;r<n;++r)i+="#";setHash(i,"listen")}}else t.isSettingUp=!0,navigator.getUserMedia_({video:!1,audio:!0},function(e){t.microphone=t.context.createMediaStreamSource(e);var n=t.context.createAnalyser();n.smoothingTimeConstant=.2,n.fftSize=1024,t.microphone.connect(n);var i=t.context.createScriptProcessor(2048,1,1);i.onaudioprocess=function(){var e=new Uint8Array(n.frequencyBinCount);n.getByteFrequencyData(e),t.volume=average(e)},n.connect(i),t.hasSetup=!0},function(){alert("allow the microphone or open in firefox/chrome")})},diy:function(e,t){var n=$("#diy"),i=n.find('input[type="range"]').val(),r=1e3-i;if(e-t.past>r){var o=n.find("textarea").val().split("\n");t.index>o.length-1&&(t.index=0),setHash(o[t.index],"diy"),t.index+=1,t.past=e;var s=encodeURI("diy."+i+"."+o.join("\\n")),a=window.location.href.split("#")[0]+"#"+s,h=$('input[type="text"]');h.val()!==a&&h.val(a)}},pewpew:function(e,t){var n=["¸",".","·","´"],i="☆",r=n[t.shipIndex];if(window.up&&(t.shipIndex+=t.shipIndex==n.length-1?0:1,window.up=!1),window.down&&(t.shipIndex-=0==t.shipIndex?0:1,window.down=!1),window.space?(t.bullets=[r].concat(t.bullets).slice(0,200),window.space=!1):t.bullets=[" "].concat(t.bullets).slice(0,200),Math.random()>.95){var o=n[Math.floor(Math.random()*n.length)];t.enemies.push(o)}else t.enemies.push(" ");t.enemies.reverse(),t.enemies=t.enemies.slice(0,200),t.enemies.reverse();var s=" score: "+t.score+" # ",a=t.dead?s+i:s+r+r;t.dead&&(t.dead=!1);for(var h=0;h<200;++h){var p=t.bullets[h]||" ",u=t.enemies[h]||" ";0==h&&u==r&&(t.score=0,t.dead=!0),p==u&&" "!=p?(a+=i,t.bullets[h]=" ",t.enemies[h]=" ",t.score+=1):a+=" "!=u?u:" "!=p?p:" "}setHash(a,"pewpew")}},setTimeout(tick,50);